<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE-edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- MATERIAL CON -->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp"
      rel="stylesheet"
    />
    <!-- STYLESHEET -->
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div class="container">
        <aside>
            <div class="top">
                <div class="logo">
                    <a href = "/"><img src="../images/logo.png"></a>
                    <h2>PINY<span class="danger"> Catch U</span></h2>
                </div>
                <div class="close" id="close-btn">
                    <span class="material-icons-sharp">close</span>
                </div>
            </div>
            <!-- ------------ sidebar ------------ -->
            <div class="sidebar">
                <a class="menu-item active" href="/main">
                    <span class="material-icons-sharp">grid_view</span>
                    <h3>Dashboard</h3>
                </a>
                <a class="menu-item" href="/mypage">
                    <span class="material-icons-sharp">person_outline</span>
                    <h3>My page</h3>
                </a>
                <a class="menu-item"  href="/video">
                    <span class="material-icons-sharp">videocam</span>
                    <h3>Video Streaming</h3>
                </a>
                <a class="menu-item" href="/storage">
                    <span class="material-icons-sharp">view_list</span>
                    <h3>Video List</h3>
                    <span class="message-count active">26</span>
                </a>
                <a class="menu-item" href = "/analytics">
                    <span class="material-symbols-sharp">public</span>
                        
                    <h3>No Smoking Map</h3>
                </a>
                
                <a href="/logout">
                    <span class="material-icons-sharp">logout</span>
                    <h3>Logout</h3>
                </a>
            </div>
        </aside>
        <!-- ------------ END OF ASIDE ------------ -->
        <main>
            <h1>Dashboard</h1>

            <div class="date">
                <input type="date">
            </div>

            <div class="insights">
                <div class="sales">
                    <a href="/video"><span class="material-icons-sharp">videocam</span></a>
                    <div class="middle">
                        <div class="left">
                            <h3>실시간 CCTV</h3>
                            <h1>작동중</h1>
                        </div>
                        <div class="progress">
                            <svg>
                                <circle cx="38" cy="38" r="36"></circle>
                            </svg>
                            <div class="number">
                                <p>ON</p>
                            </div>
                        </div>
                    </div>
                    <small class="text-muted">Last 24 Hours</small>
                </div>
                <!-- ------------ END OF SALES ------------ -->
                <div class="expenses">
                    <span class="material-icons-sharp">notifications</span>
                    <div class="middle">
                        <div class="left">
                            <h3>확인 필요한 감지알림</h3>
                            <h1>3 개</h1>
                        </div>
                        <div class="progress">
                            <svg>
                                <circle cx="38" cy="38" r="36"></circle>
                            </svg>
                            <div class="number">
                                <p>62%</p>
                            </div>
                        </div>
                    </div>
                    <small class="text-muted">Last 24 Hours</small>
                </div>
                <!-- ------------ END OF EXPENSES ------------ -->
                <div class="income">
                    <span class="material-icons-sharp">bar_chart</span>
                    <div class="middle">
                        <div class="left">
                            <h3>TODAY 총 적발건수</h3>
                            <h1>89 건</h1>
                        </div>
                        <div class="progress">
                            <svg>
                                <circle cx="38" cy="38" r="36"></circle>
                            </svg>
                            <div class="number">
                                <p>44%</p>
                            </div>
                        </div>
                    </div>
                    <small class="text-muted">Last 24 Hours</small>
                </div>
                <!-- ------------ END OF INCOME ------------ -->
            </div>
            <!-- ------------ END OF INSIGHTS ------------ -->
            <div class="recent-video">
                <h2>영상 증거물 업데이트</h2>
                <table>
                    <thead>
                        <tr>
                            <th>기록 번호</th>
                            <th>감지 일시</th>
                            <!-- <th>확인 여부</th> -->
                        </tr>
                    </thead>
                    <tbody>
                       <tr th:each="s : ${session.result_storage2}">
                            <td th:text="${s.idx}">Index</td>
                            <td th:text="${s.record_start}">Record Start</td>
                            <!-- <td class="primary"><span class="material-icons-sharp">check_circle_outline</span></td> -->
                        </tr>
                        
                    </tbody>
                </table>
                <a href="/storage">Show All</a>
            
            <button id="sendEmailButton">이메일 전송</button>
                
            </div>
        </main>
        <!-- ------------ END OF MAIN ------------ -->

        <div class="right">
            <div class="top">
                <button id="menu-btn">
                    <span class="material-icons-sharp">menu</span>
                </button>
                <div class="theme-toggler">
                    <span class="material-icons-sharp active">light_mode</span>
                    <span class="material-icons-sharp">dark_mode</span>
                </div>
                <div class="profile">
                    <div class="info">
                        <p>Hey, <b th:text="${session.loginMember.id}"></b></p>
                        <small class="text-muted" th:text="${session.loginMember.email}"></small>
                    </div>
                    <div class="profile-photo">
                        <img src="../images/profile2.jpg" alt="">
                    </div>
                </div>
            </div>
            <!-- END OF TOP -->
            <div class="recent-updates">
                <div class="chat-container">
                    <div class="chat-header">Chat Room</div>
                    <div class="chat-body" id="chatBody">
                      <!-- Messages will be appended here dynamically using JavaScript -->
                    </div>
                    <div class="input-container">
                      <input
                        type="text"
                        class="input-box"
                        id="messageInput"
                        placeholder="Type your message..."
                      />
                      <button class="send-button" onclick="sendMessage()">Send</button>
                    </div>
                  </div>
                <!-- <iframe src="https://www.google.co.kr/maps/d/embed?mid=1yzdWIFxpGE6zvCh1JwHksyw-vE1saxo&amp;ehbc=2E312F" width="300" height="300"></iframe> -->
            </div>
            <!-- ------------ START OF RIGHT-BOTTOM ------------ -->
            <div class="calendar-container">
                <div class="calendar">
                    <div class="calendar-header">
                        <span class="month-picker" id="month-picker">May </span>
                        <div class="year-picker" id="year-picker">
                            <span class="year-change" id="pre-year">
                                <pre><</pre>
                            </span>
                            <span id="year">2023 </span>
                            <span class="year-change" id="next-year">
                                <pre>></pre>
                            </span>
                        </div>
                    </div>

                    <div class="calender-body">
                        <div class="calendar-week-days">
                            <div>Sun</div>
                            <div>Mon</div>
                            <div>Tue</div>
                            <div>Wed</div>
                            <div>Thu</div>
                            <div>Fri</div>
                            <div>Sat</div>
                        </div>
                        <div class="calendar-days"></div>
                    </div>
                    <div class="calendar-footer"></div>
                    <div class="month-list"></div>
                </div>
            </div>

        </div>

    <script src="../js/main.js"></script>
    
    <script>
      $(document).ready(function () {
        $("#sendEmailButton").click(function (event) {
          event.preventDefault(); // 버튼의 기본 동작 중지 (페이지 이동 방지)

          // AJAX 요청
          $.ajax({
            url: "/sendemail", // 이메일 전송을 처리하는 URL
            type: "POST", // 전송 방식 (POST)
            success: function (response) {
              alert("이메일이 성공적으로 전송되었습니다!");
              // 성공 시 수행할 작업 추가
            },
            error: function (xhr, status, error) {
              alert("이메일 전송에 실패했습니다!");
              // 실패 시 수행할 작업 추가
            },
          });
        });
      });
    </script>
    <script>
        // local host가 아니라 나의 컴퓨터의 ip주소를 입력해줘야 한다 
        // chat2.html에서 바꿔주었더니 작동이 된다 
        const webSocket = new WebSocket("ws://172.30.1.18:3001");
  
        webSocket.onopen = function () {
          const chatArea = document.getElementById("chatBody");
          chatArea.innerHTML = "WebSocket connection established.";
        };
  
        webSocket.onmessage = function (event) {
          appendOtherMessage(event.data);
          updateChatScroll();
        };
  
        webSocket.onclose = function () {
          const chatArea = document.getElementById("chatBody");
          chatArea.innerHTML = "WebSocket connection closed.";
        };
  
        webSocket.onerror = function (error) {
          console.error(error);
        };
  
        function sendMessage() {
          var messageInput = document.getElementById("messageInput");
          var message = messageInput.value.trim();
          if (message !== "") {
            appendUserMessage(message);
            webSocket.send(message);
            messageInput.value = "";
            updateChatScroll();
          }
        }
  
        function appendUserMessage(message) {
          appendMessage("user-message", message);
        }
  
        function appendOtherMessage(message) {
          appendMessage("other-message", message);
        }
  
        function appendMessage(className, message) {
          const chatBody = document.getElementById("chatBody");
          const messageDiv = document.createElement("div");
          messageDiv.className = "message " + className;
  
          // Display the username
          var usernameElement = document.createElement("div");
          usernameElement.classList.add("username");
          usernameElement.textContent = "Username"; // Replace with the actual username variable you have
  
          var messageElement = document.createElement("div");
          messageElement.classList.add(className);
          messageElement.textContent = message;
  
          messageDiv.appendChild(usernameElement);
          messageDiv.appendChild(messageElement);
  
          chatBody.appendChild(messageDiv);
        }
  
        function updateChatScroll() {
          const chatArea = document.getElementById("chatBody");
          chatArea.scrollTop = chatArea.scrollHeight;
        }
      </script>
  
      <!-- ../app.js -->
      <!-- 서버에 연결 -->
      <script src="../js/client.js"></script>
     
  </body>
</html>